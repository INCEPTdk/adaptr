<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function setups (or removes) a default cluster for use in all
parallelised functions in adaptr using the parallel package. The function
also exports objects that should be available on the cluster and sets the
random number generator appropriately. See Details for further info on
how adaptr handles sequential/parallel computation."><title>Setup default cluster for use in parallelised adaptr functions — setup_cluster • adaptr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Setup default cluster for use in parallelised adaptr functions — setup_cluster"><meta property="og:description" content="This function setups (or removes) a default cluster for use in all
parallelised functions in adaptr using the parallel package. The function
also exports objects that should be available on the cluster and sets the
random number generator appropriately. See Details for further info on
how adaptr handles sequential/parallel computation."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">adaptr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Overview.html">Overview</a>
    <a class="dropdown-item" href="../articles/Basic-examples.html">Basic examples</a>
    <a class="dropdown-item" href="../articles/Advanced-example.html">Advanced example</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/INCEPTdk/adaptr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Setup default cluster for use in parallelised adaptr functions</h1>
      <small class="dont-index">Source: <a href="https://github.com/INCEPTdk/adaptr/blob/HEAD/R/setup_cluster.R" class="external-link"><code>R/setup_cluster.R</code></a></small>
      <div class="d-none name"><code>setup_cluster.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function setups (or removes) a default cluster for use in all
parallelised functions in <code>adaptr</code> using the <code>parallel</code> package. The function
also exports objects that should be available on the cluster and sets the
random number generator appropriately. See <strong>Details</strong> for further info on
how <code>adaptr</code> handles sequential/parallel computation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">setup_cluster</span><span class="op">(</span><span class="va">cores</span>, export <span class="op">=</span> <span class="cn">NULL</span>, export_envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>cores</dt>
<dd><p>can be either unspecified, <code>NULL</code>, or a single integer <code>&gt; 0</code>. If
<code>NULL</code> or <code>1</code>, an existing default cluster is removed (if any), and the
default will subsequently be to run functions sequentially in the main
process if <code>cores = 1</code>, and according to <code>getOption("mc.cores")</code> if <code>NULL</code>
(unless otherwise specified in individual functions calls). The
<code><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">parallel::detectCores()</a></code> function may be used to see the number of
available cores, although this comes with some caveats (as described in the
function documentation), including that the number of cores may not always
be returned and may not match the number of cores that are available for
use. In general, using less cores than available may be preferable if other
processes are run on the machine at the same time.</p></dd>


<dt>export</dt>
<dd><p>character vector of names of objects to export to each
parallel core when running in parallel; passed as the <code>varlist</code> argument to
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parallel::clusterExport()</a></code>. Defaults to <code>NULL</code> (no objects exported),
ignored if <code>cores == 1</code>. See <strong>Details</strong> below.</p></dd>


<dt>export_envir</dt>
<dd><p><code>environment</code> where to look for the objects defined
in <code>export</code> when running in parallel and <code>export</code> is not <code>NULL</code>. Defaults
to the environment from where the function is called.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Invisibly returns the default <code>parallel</code> cluster or <code>NULL</code>, as
appropriate. This may be used with other functions from the <code>parallel</code></p>


<p>package by advanced users, for example to load certain libraries on the
cluster prior to calling <code><a href="run_trials.html">run_trials()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Using sequential or parallel computing in adaptr</strong></p>
<p>All parallelised <code>adaptr</code> functions have a <code>cores</code> argument that defaults to
<code>NULL</code>. If a non-<code>NULL</code> integer <code>&gt; 0</code> is provided to the <code>cores</code> argument in
any of those (except <code>setup_cluster()</code>), the package will run calculations
sequentially in the main process if <code>cores = 1</code>, and otherwise initiate a new
cluster of size <code>cores</code> that will be removed once the function completes,
regardless of whether or not a default cluster or the global <code>"mc.cores"</code>
option have been specified.</p>
<p>If <code>cores</code> is <code>NULL</code> in any <code>adaptr</code> function (except <code>setup_cluster()</code>), the
package will use a default cluster if one exists or run computations
sequentially if <code>setup_cluster()</code> has last been called with <code>cores = 1</code>.
If <code>setup_cluster()</code> has not been called or last called with <code>cores = NULL</code>,
then the package will check if the global <code>"mc.cores"</code> option has been
specified (using <code>options(mc.cores = &lt;number of cores&gt;)</code>). If this option has
been set with a value <code>&gt; 1</code>, then a new, temporary cluster of that size is
setup, used, and removed once the function completes. If this option has not
been set or has been set to <code>1</code>, then computations will be run sequentially
in the main process.</p>
<p>Generally, we recommend using the <code>setup_cluster()</code> function as this avoids
the overhead of re-initiating new clusters with every call to one of the
parallelised <code>adaptr</code> functions. This is especially important when exporting
many or large objects to a <code>parallel</code> cluster, as this can then be done only
once (with the option to export further objects to the same cluster when
calling <code><a href="run_trials.html">run_trials()</a></code>).</p>
<p><strong>Type of clusters used and random number generation</strong></p>
<p>The <code>adaptr</code> package solely uses parallel socket clusters (using
<code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::makePSOCKcluster()</a></code>) and thus does not use forking (as this is not
available on all operating systems and may cause crashes in some situations).
As such, user-defined objects that should be used by the <code>adaptr</code> functions
when run in parallel need to be exported using either <code>setup_cluster()</code> or
<code><a href="run_trials.html">run_trials()</a></code>, if not included in the generated <code>trial_spec</code> object.</p>
<p>The <code>adaptr</code> package uses the <code>"L'Ecuyer-CMRG"</code> kind (see <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">RNGkind()</a></code>) for
safe random number generation for all parallelised functions. This is also
the case when running <code>adaptr</code> functions sequentially with a seed provided,
to ensure that the same results are obtained regardless of whether sequential
or parallel computation is used. All functions restore both the random number
generator kind and the global random seed after use if called with a seed.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setup a cluster using 2 cores</span></span></span>
<span class="r-in"><span><span class="fu">setup_cluster</span><span class="op">(</span>cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get existing default cluster (printed here as invisibly returned)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="fu">setup_cluster</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> socket cluster with 2 nodes on host ‘localhost’</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Remove existing default cluster</span></span></span>
<span class="r-in"><span><span class="fu">setup_cluster</span><span class="op">(</span>cores <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specify preference for running computations sequentially</span></span></span>
<span class="r-in"><span><span class="fu">setup_cluster</span><span class="op">(</span>cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Remove default cluster preference</span></span></span>
<span class="r-in"><span><span class="fu">setup_cluster</span><span class="op">(</span>cores <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set global option to default to using 2 new clusters each time</span></span></span>
<span class="r-in"><span><span class="co"># (only used if no default cluster preference is specified)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Anders Granholm, Benjamin Skov Kaas-Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

