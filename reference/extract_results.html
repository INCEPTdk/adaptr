<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function extracts relevant information from multiple simulations of the
same trial specification in a tidy data.frame (1 simulation per row).
See also the check_performance() and summary() functions, that uses the
output from this function to further summarise simulation results."><title>Extract simulation results — extract_results • adaptr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extract simulation results — extract_results"><meta property="og:description" content="This function extracts relevant information from multiple simulations of the
same trial specification in a tidy data.frame (1 simulation per row).
See also the check_performance() and summary() functions, that uses the
output from this function to further summarise simulation results."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">adaptr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Overview.html">Overview</a>
    <a class="dropdown-item" href="../articles/Basic-examples.html">Basic examples</a>
    <a class="dropdown-item" href="../articles/Advanced-example.html">Advanced example</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/INCEPTdk/adaptr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Extract simulation results</h1>
      <small class="dont-index">Source: <a href="https://github.com/INCEPTdk/adaptr/blob/HEAD/R/extract_results.R" class="external-link"><code>R/extract_results.R</code></a></small>
      <div class="d-none name"><code>extract_results.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function extracts relevant information from multiple simulations of the
same trial specification in a tidy <code>data.frame</code> (1 simulation per row).
See also the <code><a href="check_performance.html">check_performance()</a></code> and <code><a href="summary.html">summary()</a></code> functions, that uses the
output from this function to further summarise simulation results.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">extract_results</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  select_strategy <span class="op">=</span> <span class="st">"control if available"</span>,</span>
<span>  select_last_arm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  select_preferences <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  te_comp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  raw_ests <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  final_ests <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cores <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p><code>trial_results</code> object, output from the <code><a href="run_trials.html">run_trials()</a></code>
function.</p></dd>


<dt>select_strategy</dt>
<dd><p>single character string. If a trial was not stopped
due to superiority (or had only 1 arm remaining, if <code>select_last_arm</code> is
set to <code>TRUE</code> in trial designs with a common <code>control</code> arm; see below),
this parameter specifies which arm will be considered selected when
calculating trial design performance metrics, as described below;
this corresponds to the consequence of an inconclusive trial, i.e., which
arm would then be used in practice.<br>
The following options are available and must be written exactly as below
(case sensitive, cannot be abbreviated):</p><ul><li><p><code>"control if available"</code> (default): selects the <strong>first</strong>
<code>control</code> arm for trials with a common <code>control</code> arm <em><strong>if</strong></em> this
arm is active at end-of-trial, otherwise no arm will be selected. For
trial designs without a common <code>control</code>, no arm will be selected.</p></li>
<li><p><code>"none"</code>: selects no arm in trials not ending with superiority.</p></li>
<li><p><code>"control"</code>: similar to <code>"control if available"</code>, but will throw
an error if used for trial designs without a common <code>control</code> arm.</p></li>
<li><p><code>"final control"</code>: selects the <strong>final</strong> <code>control</code> arm regardless
of whether the trial was stopped for practical equivalence, futility,
or at the maximum sample size; this strategy can only be specified
for trial designs with a common <code>control</code> arm.</p></li>
<li><p><code>"control or best"</code>: selects the <strong>first</strong> <code>control</code> arm if still
active at end-of-trial, otherwise selects the best remaining arm
(defined as the remaining arm with the highest probability of being
the best in the last adaptive analysis conducted). Only works for
trial designs with a common <code>control</code> arm.</p></li>
<li><p><code>"best"</code>: selects the best remaining arm (as described under
<code>"control or best"</code>).</p></li>
<li><p><code>"list or best"</code>: selects the first remaining arm from a specified
list (specified using <code>select_preferences</code>, technically a character
vector). If none of these arms are are active at end-of-trial, the best
remaining arm will be selected (as described above).</p></li>
<li><p><code>"list"</code>: as specified above, but if no arms on the provided list
remain active at end-of-trial, no arm is selected.</p></li>
</ul></dd>


<dt>select_last_arm</dt>
<dd><p>single logical, defaults to <code>FALSE</code>. If <code>TRUE</code>, the
only remaining active arm (the last <code>control</code>) will be selected in trials
with a common <code>control</code> arm ending with <code>equivalence</code> or <code>futility</code>, before
considering the options specified in <code>select_strategy</code>. Must be <code>FALSE</code> for
trial designs without a common <code>control</code> arm.</p></dd>


<dt>select_preferences</dt>
<dd><p>character vector specifying a number of arms used
for selection if one of the <code>"list or best"</code> or <code>"list"</code> options are
specified for <code>select_strategy</code>. Can only contain valid <code>arms</code>
available in the trial.</p></dd>


<dt>te_comp</dt>
<dd><p>character string, treatment-effect comparator. Can be either
<code>NULL</code> (the default) in which case the <strong>first</strong> <code>control</code> arm is used for
trial designs with a common control arm, or a string naming a single trial
<code>arm</code>. Will be used when calculating <code>err_te</code> and <code>sq_err_te</code> (the error
and the squared error of the treatment effect comparing the selected arm to
the comparator arm, as described below).</p></dd>


<dt>raw_ests</dt>
<dd><p>single logical. If <code>FALSE</code> (default), the
posterior estimates (<code>post_ests</code> or <code>post_ests_all</code>, see <code><a href="setup_trial.html">setup_trial()</a></code>
and <code><a href="run_trial.html">run_trial()</a></code>) will be used to calculate <code>err</code> and <code>sq_err</code> (the error
and the squared error of the estimated compared to the specified effect in
the selected arm) and <code>err_te</code> and <code>sq_err_te</code> (the error and the squared
error of the treatment effect comparing the selected arm to the comparator
arm, as described for <code>te_comp</code> and below). If <code>TRUE</code>, the raw estimates
(<code>raw_ests</code> or <code>raw_ests_all</code>, see <code><a href="setup_trial.html">setup_trial()</a></code> and <code><a href="run_trial.html">run_trial()</a></code>) will
be used instead of the posterior estimates.</p></dd>


<dt>final_ests</dt>
<dd><p>single logical. If <code>TRUE</code> (recommended) the final estimates
calculated using outcome data from all patients randomised when trials are
stopped are used (<code>post_ests_all</code> or <code>raw_ests_all</code>, see <code><a href="setup_trial.html">setup_trial()</a></code>
and <code><a href="run_trial.html">run_trial()</a></code>); if <code>FALSE</code>, the estimates calculated for each arm when
an arm is stopped (or at the last adaptive analysis if not before) using
data from patients having reach followed up at this time point and not all
patients randomised are used (<code>post_ests</code> or <code>raw_ests</code>, see
<code><a href="setup_trial.html">setup_trial()</a></code> and <code><a href="run_trial.html">run_trial()</a></code>). If <code>NULL</code> (the default), this argument
will be set to <code>FALSE</code> if outcome data are available immediate after
randomisation for all patients (for backwards compatibility, as final
posterior estimates may vary slightly in this situation, even if using the
same data); otherwise it will be said to <code>TRUE</code>. See <code><a href="setup_trial.html">setup_trial()</a></code> for
more details on how these estimates are calculated.</p></dd>


<dt>cores</dt>
<dd><p><code>NULL</code> or single integer. If <code>NULL</code>, a default value set by
<code><a href="setup_cluster.html">setup_cluster()</a></code> will be used to control whether extractions of simulation
results are done in parallel on a default cluster or sequentially in the
main process; if a value has not been specified by <code><a href="setup_cluster.html">setup_cluster()</a></code>,
<code>cores</code> will then be set to the value stored in the global <code>"mc.cores"</code>
option (if previously set by <code>options(mc.cores = &lt;number of cores&gt;</code>), and
<code>1</code> if that option has not been specified.<br>
If <code>cores = 1</code>, computations
will be run sequentially in the primary process, and if <code>cores &gt; 1</code>, a new
parallel cluster will be setup using the <code>parallel</code> library and removed
once the function completes. See <code><a href="setup_cluster.html">setup_cluster()</a></code> for details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <code>data.frame</code> containing the following columns:</p><ul><li><p><code>sim</code>: the simulation number (from <code>1</code> to the total number of
simulations).</p></li>
<li><p><code>final_n</code>: the final sample size in each simulation.</p></li>
<li><p><code>sum_ys</code>: the sum of the total counts in all arms, e.g., the total
number of events in trials with a binary outcome
(<code><a href="setup_trial_binom.html">setup_trial_binom()</a></code>) or the sum of the arm totals in trials with a
continuous outcome (<code><a href="setup_trial_norm.html">setup_trial_norm()</a></code>). Always uses all outcome data
from all randomised patients regardless of whether or not all patients
had outcome data available at the time of trial stopping (corresponding
to <code>sum_ys_all</code> in results from <code><a href="run_trial.html">run_trial()</a></code>).</p></li>
<li><p><code>ratio_ys</code>: calculated as <code>sum_ys/final_n</code> (as described above).</p></li>
<li><p><code>final_status</code>: the final trial status for each simulation, either
<code>"superiority"</code>, <code>"equivalence"</code>, <code>"futility"</code>, or <code>"max"</code>, as
described in <code><a href="run_trial.html">run_trial()</a></code>.</p></li>
<li><p><code>superior_arm</code>: the final superior arm in simulations stopped for
superiority. Will be <code>NA</code> in simulations not stopped for superiority.</p></li>
<li><p><code>selected_arm</code>: the final selected arm (as described above). Will
correspond to the <code>superior_arm</code> in simulations stopped for superiority
and be <code>NA</code> if no arm is selected. See <code>select_strategy</code> above.</p></li>
<li><p><code>err</code>: the squared error of the estimate in the selected arm,
calculated as <code>estimated effect - true effect</code> for the selected
arm.</p></li>
<li><p><code>sq_err:</code> the squared error of the estimate in the selected arm,
calculated as <code>err^2</code> for the selected arm, with <code>err</code> defined above.</p></li>
<li><p><code>err_te</code>: the error of the treatment effect comparing the selected
arm to the comparator arm (as specified in <code>te_comp</code>). Calculated as:<br><code>(estimated effect in the selected arm - estimated effect in the comparator arm) -</code>
<code>(true effect in the selected arm - true effect in the comparator arm)</code>
<br> Will be <code>NA</code> for simulations without a selected arm, with no
comparator specified (see <code>te_comp</code> above), and when the selected arm
is the comparator arm.</p></li>
<li><p><code>sq_err_te</code>: the squared error of the treatment effect comparing
the selected arm to the comparator arm (as specified in <code>te_comp</code>),
calculated as <code>err_te^2</code>, with <code>err_te</code> defined above.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="check_performance.html">check_performance()</a></code>, <code><a href="summary.html">summary()</a></code>, <code><a href="plot_convergence.html">plot_convergence()</a></code>,
<code><a href="plot_metrics_ecdf.html">plot_metrics_ecdf()</a></code>, <code><a href="check_remaining_arms.html">check_remaining_arms()</a></code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Setup a trial specification</span></span></span>
<span class="r-in"><span><span class="va">binom_trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="setup_trial_binom.html">setup_trial_binom</a></span><span class="op">(</span>arms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                 control <span class="op">=</span> <span class="st">"A"</span>,</span></span>
<span class="r-in"><span>                                 true_ys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.20</span>, <span class="fl">0.18</span>, <span class="fl">0.22</span>, <span class="fl">0.24</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                 data_looks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run 10 simulations with a specified random base seed</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="run_trials.html">run_trials</a></span><span class="op">(</span><span class="va">binom_trial</span>, n_rep <span class="op">=</span> <span class="fl">10</span>, base_seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract results and Select the control arm if available</span></span></span>
<span class="r-in"><span><span class="co"># in simulations not ending with superiority</span></span></span>
<span class="r-in"><span><span class="fu">extract_results</span><span class="op">(</span><span class="va">res</span>, select_strategy <span class="op">=</span> <span class="st">"control"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    sim final_n sum_ys ratio_ys final_status superior_arm selected_arm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    1    2000    387   0.1935          max         &lt;NA&gt;            A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    2    2000    391   0.1955          max         &lt;NA&gt;            A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    3    2000    359   0.1795          max         &lt;NA&gt;         &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    4    2000    389   0.1945          max         &lt;NA&gt;            A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    5    2000    373   0.1865          max         &lt;NA&gt;            A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    6     400     84   0.2100  superiority            B            B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7    7    2000    395   0.1975          max         &lt;NA&gt;            A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8    8    2000    442   0.2210          max         &lt;NA&gt;            A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9    9    2000    413   0.2065          max         &lt;NA&gt;            A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  10    2000    466   0.2330          max         &lt;NA&gt;            A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             err       sq_err     err_te sq_err_te</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   0.027072360 7.329127e-04         NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   0.027225919 7.412507e-04         NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            NA           NA         NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   0.028619492 8.190753e-04         NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  -0.014477338 2.095933e-04         NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  -0.022699865 5.152839e-04 -0.1820624 0.0331467</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   0.009098866 8.278937e-05         NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   0.010663973 1.137203e-04         NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   0.015544164 2.416210e-04         NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  0.019152691 3.668256e-04         NA        NA</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anders Granholm, Benjamin Skov Kaas-Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

