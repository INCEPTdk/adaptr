<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='This function conducts a single trial simulation using a trial specification
as specified by setup_trial(), setup_trial_binom() or
setup_trial_norm().
During simulation, the function randomises "patients", randomly generates
outcomes, calculates the probabilities that each arm is the best (and
better than the control, if any). This is followed by checking inferiority,
superiority, equivalence and/or futility as desired; dropping arms, and
re-adjusting allocation probabilities according to the criteria specified in
the trial specification. If there is no common control arm, the trial
simulation will be stopped at the maximum sample size, when 1 arm is superior
to the others, or when all arms are considered equivalent (if equivalence
testing is specified).
If a common control arm is specified, all other arms will be compared to
that, and if 1 comparison crosses the superiority threshold, that arm will
become the new control and the old control will be considered inferior. If
multiple non-control arms cross the superiority threshold in the same
analysis, the one with the highest probability of being the overall best will
become the new control. Equivalence/futility will also be checked in trial
designs with common controls if specified, and equivalent or futile arms will
be dropped. The trial simulation will be stopped when only 1 arm is left,
when the final arms are all equivalent, or when the maximum sample size has
been reached.'><title>Simulate a single trial — run_trial • adaptr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate a single trial — run_trial"><meta property="og:description" content='This function conducts a single trial simulation using a trial specification
as specified by setup_trial(), setup_trial_binom() or
setup_trial_norm().
During simulation, the function randomises "patients", randomly generates
outcomes, calculates the probabilities that each arm is the best (and
better than the control, if any). This is followed by checking inferiority,
superiority, equivalence and/or futility as desired; dropping arms, and
re-adjusting allocation probabilities according to the criteria specified in
the trial specification. If there is no common control arm, the trial
simulation will be stopped at the maximum sample size, when 1 arm is superior
to the others, or when all arms are considered equivalent (if equivalence
testing is specified).
If a common control arm is specified, all other arms will be compared to
that, and if 1 comparison crosses the superiority threshold, that arm will
become the new control and the old control will be considered inferior. If
multiple non-control arms cross the superiority threshold in the same
analysis, the one with the highest probability of being the overall best will
become the new control. Equivalence/futility will also be checked in trial
designs with common controls if specified, and equivalent or futile arms will
be dropped. The trial simulation will be stopped when only 1 arm is left,
when the final arms are all equivalent, or when the maximum sample size has
been reached.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">adaptr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Advanced-example.html">Advanced example</a>
    <a class="dropdown-item" href="../articles/Basic-examples.html">Basic examples</a>
    <a class="dropdown-item" href="../articles/Overview.html">Overview</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/INCEPTdk/adaptr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulate a single trial</h1>
      <small class="dont-index">Source: <a href="https://github.com/INCEPTdk/adaptr/blob/HEAD/R/run_trial.R" class="external-link"><code>R/run_trial.R</code></a></small>
      <div class="d-none name"><code>run_trial.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function conducts a single trial simulation using a trial specification
as specified by <code><a href="setup_trial.html">setup_trial()</a></code>, <code><a href="setup_trial_binom.html">setup_trial_binom()</a></code> or
<code><a href="setup_trial_norm.html">setup_trial_norm()</a></code>.
During simulation, the function randomises "patients", randomly generates
outcomes, calculates the probabilities that each <code>arm</code> is the best (and
better than the control, if any). This is followed by checking inferiority,
superiority, equivalence and/or futility as desired; dropping arms, and
re-adjusting allocation probabilities according to the criteria specified in
the trial specification. If there is no common <code>control</code> arm, the trial
simulation will be stopped at the maximum sample size, when 1 arm is superior
to the others, or when all arms are considered equivalent (if equivalence
testing is specified).<br>
If a common <code>control</code> arm is specified, all other arms will be compared to
that, and if 1 comparison crosses the superiority threshold, that arm will
become the new control and the old control will be considered inferior. If
multiple non-control arms cross the superiority threshold in the same
analysis, the one with the highest probability of being the overall best will
become the new control. Equivalence/futility will also be checked in trial
designs with common controls if specified, and equivalent or futile arms will
be dropped. The trial simulation will be stopped when only 1 arm is left,
when the final arms are all equivalent, or when the maximum sample size has
been reached.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_trial</span><span class="op">(</span><span class="va">trial_spec</span>, seed <span class="op">=</span> <span class="cn">NULL</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>trial_spec</dt>
<dd><p><code>trial_spec</code> object, generated and validated by the
<code><a href="setup_trial.html">setup_trial()</a></code>, <code><a href="setup_trial_binom.html">setup_trial_binom()</a></code> or <code><a href="setup_trial_norm.html">setup_trial_norm()</a></code> function.</p></dd>


<dt>seed</dt>
<dd><p>single integer or <code>NULL</code> (default), if a value is provided, this
value will be used as the random seed when running (the global random seed
will be restored after the function has run, so it is not affected).</p></dd>


<dt>sparse</dt>
<dd><p>single logical; if <code>FALSE</code> (default) everything listed below is
included in the returned object. If <code>TRUE</code>, only a limited amount of data
is included in the returned object. This can be practical when running many
simulations and saving the results using the <code><a href="run_trials.html">run_trials()</a></code> function (which
relies on this function), as the output file will thus be substantially
smaller. However, printing of individual trial results will be
substantially less detailed for sparse results and non-sparse results are
required by <code><a href="plot_history.html">plot_history()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <code>trial_result</code> object containing everything listed below if
<code>sparse</code> (as described above) is <code>FALSE</code>. Otherwise only <code>final_status</code>,
<code>final_n</code>, <code>trial_res</code>, <code>seed</code> and <code>sparse</code> are included.</p><ul><li><p><code>final_status</code>: either <code>"superiority"</code>, <code>"equivalence"</code>,
<code>"futility"</code>, or <code>"max"</code>.</p></li>
<li><p><code>final_n</code>: the total number of patients randomised.</p></li>
<li><p><code>max_n</code>: the pre-specified maximum sample size.</p></li>
<li><p><code>looks</code>: numeric vector, the total number of patients at each
conducted adaptive analysis.</p></li>
<li><p><code>planned_looks</code>: numeric vector, the cumulated number of patients
planned to be randomised at each adaptive analysis, even those not
conducted if the simulation is stopped before the maximum sample size.</p></li>
<li><p><code>start_control</code>: character, initial common control arm (if
specified).</p></li>
<li><p><code>final_control</code>: character, final common control arm (if relevant).</p></li>
<li><p><code>control_prob_fixed</code>: fixed common control arm probabilities (if
specified; see <code><a href="setup_trial.html">setup_trial()</a></code>).</p></li>
<li><p><code>inferiority</code>, <code>superiority</code>, <code>equivalence_prob</code>,
<code>equivalence_diff</code>, <code>equivalence_only_first</code>, <code>futility_prob</code>,
<code>futility_diff</code>, <code>futility_only_first</code>, <code>highest_is_best</code>, and
<code>soften_power</code>: as specified in <code><a href="setup_trial.html">setup_trial()</a></code>.</p></li>
<li><p><code>best_arm</code>: the best arm(s), as described in <code><a href="setup_trial.html">setup_trial()</a></code>.</p></li>
<li><p><code>trial_res</code>: a <code>data.frame</code> containing most of the information
specified for each arm in <code><a href="setup_trial.html">setup_trial()</a></code> including <code>true_ys</code> (true
outcomes as specified in <code><a href="setup_trial.html">setup_trial()</a></code>) and for each arm the sum of
the outcomes (<code>sum_ys</code>; i.e., the total number of events for binary
outcomes or the totals of continuous outcomes) and patients randomised
(<code>ns</code>), summary statistics for the raw outcome data (<code>raw_ests</code>,
calculated as specified in <code><a href="setup_trial.html">setup_trial()</a></code>, defaults to mean values,
i.e., event rates for binary outcomes or means for continuous outcomes)
and posterior estimates (<code>post_ests</code>, <code>post_errs</code>, <code>lo_cri</code>, and
<code>hi_cri</code>, as specified in <code><a href="setup_trial.html">setup_trial()</a></code>), <code>final_status</code> of each arm
(<code>"inferior"</code>, <code>"superior"</code>, <code>"equivalence"</code>, <code>"futile"</code>, <code>"active"</code>,
or <code>"control"</code> (currently active control arm, including if the current
control when stopped for equivalence)),
<code>status_look</code> (specifying the cumulated number of patients randomised
when an adaptive analysis changed the <code>final_status</code> to <code>"superior"</code>,
<code>"inferior"</code>, <code>"equivalence"</code>, or <code>"futile"</code>), <code>status_probs</code>, the
probability that each treatment was the best/better than the common
control arm (if any)/equivalent to the common control arm (if any and
stopped for equivalence; <code>NA</code> if the control arm was stopped due to the
last remaining other arm(s) being stopped for equivalence)/futile if
stopped for futility at the last analysis it was included in,
<code>final_alloc</code>, the final allocation probability for each arm the last
time patients were randomised to it, including for arms stopped at the
maximum sample size, and <code>probs_best_last</code>, the probabilities of each
remaining arm being the overall best in the last conducted analysis
(<code>NA</code> for previously dropped arms).</p></li>
<li><p><code>all_looks</code>: a list of lists containing one list per conducted
trial look (adaptive analysis). These lists contain the variables
<code>arms</code>, <code>old_status</code> (status before the analysis of the current round
was conducted), <code>new_status</code> (as specified above, status after current
analysis has been conducted), <code>sum_ys</code> (as described above), <code>ns</code> (as
described above), <code>old_alloc</code> (the allocation probability used during
this look), <code>probs_best</code> (the probabilities of each arm being the best
in the current adaptive analysis), <code>new_alloc</code> (the allocation
probabilities after updating these in the current adaptive analysis; NA
for all arms when the trial is stopped and no further analyses will be
conducted), <code>probs_better_first</code> (if a common control is provided,
specifying the probabilities that each arm was better than the control
in the first analysis conducted during that look), <code>probs_better</code> (as
<code>probs_better_first</code>, but updated if another arm becomes the new
control), <code>probs_equivalence_first</code> and <code>probs_equivalence</code> (as for
<code>probs_better</code>/<code>probs_better_first</code>, but for equivalence if equivalence
is assessed). The last variables are <code>NA</code> if the arm was not active in
the applicable adaptive analysis or if they would not be included
during the next adaptive analysis.</p></li>
<li><p><code>allocs</code>: a character vector containing the allocations of all
patients in the order of randomization.</p></li>
<li><p><code>ys</code>: a numeric vector containing the outcomes of all patients in
the order of randomization (<code>0</code> or <code>1</code> for binary outcomes).</p></li>
<li><p><code>seed</code>: the random seed used, if specified.</p></li>
<li><p><code>description</code>, <code>add_info</code>, <code>cri_width</code>, <code>n_draws</code>, <code>robust</code>: as
specified in <code><a href="setup_trial.html">setup_trial()</a></code>, <code><a href="setup_trial_binom.html">setup_trial_binom()</a></code> or
<code><a href="setup_trial_norm.html">setup_trial_norm()</a></code>.</p></li>
<li><p><code>sparse</code>: single logical, corresponding to the <code>sparse</code> input.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Setup a trial specification</span></span></span>
<span class="r-in"><span><span class="va">binom_trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="setup_trial_binom.html">setup_trial_binom</a></span><span class="op">(</span>arms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                 true_ys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.20</span>, <span class="fl">0.18</span>, <span class="fl">0.22</span>, <span class="fl">0.24</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                 data_looks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run trial with a specified random seed</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">run_trial</span><span class="op">(</span><span class="va">binom_trial</span>, seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Print results with 3 decimals</span></span></span>
<span class="r-in"><span><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">res</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Single simulation result: generic binomially distributed outcome trial</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Undesirable outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * No common control arm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Final status: inconclusive, stopped at maximum sample size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Final/maximum allowed sample sizes: 2000/2000 (100.0%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Final trial results:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  arms true_ys sum_ys   ns raw_ests post_ests post_errs lo_cri hi_cri</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     A    0.20     39  161    0.242     0.244   0.03461  0.180  0.315</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     B    0.18    297 1613    0.184     0.184   0.00938  0.166  0.204</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     C    0.22     39  180    0.217     0.219   0.03105  0.164  0.283</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     D    0.24     16   46    0.348     0.353   0.06967  0.226  0.492</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  final_status status_look status_probs final_alloc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        active          NA           NA      0.0232</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        active          NA           NA      0.8868</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        active          NA           NA      0.0900</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      inferior         300       0.0092      0.1078</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simulation details:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Random seed: 12345</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Credible interval width: 95%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Number of posterior draws: 5000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Posterior estimation method: medians with MAD-SDs</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Anders Granholm, Benjamin Skov Kaas-Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

