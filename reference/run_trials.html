<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function conducts multiple simulations using a trial specification as
specified by setup_trial(), setup_trial_binom() or setup_trial_norm().
This function essentially manages random seeds and runs multiple simulation
using run_trial() - additional details on individual simulations are
provided in that function's description. This function allows simulating
trials in parallel using multiple cores, automatically saving and re-loading
saved objects, and &quot;growing&quot; already saved simulation files (i.e., appending
additional simulations to the same file)."><title>Simulate multiple trials — run_trials • adaptr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate multiple trials — run_trials"><meta property="og:description" content="This function conducts multiple simulations using a trial specification as
specified by setup_trial(), setup_trial_binom() or setup_trial_norm().
This function essentially manages random seeds and runs multiple simulation
using run_trial() - additional details on individual simulations are
provided in that function's description. This function allows simulating
trials in parallel using multiple cores, automatically saving and re-loading
saved objects, and &quot;growing&quot; already saved simulation files (i.e., appending
additional simulations to the same file)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">adaptr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Overview.html">Overview</a>
    <a class="dropdown-item" href="../articles/Basic-examples.html">Basic examples</a>
    <a class="dropdown-item" href="../articles/Advanced-example.html">Advanced example</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/INCEPTdk/adaptr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulate multiple trials</h1>
      <small class="dont-index">Source: <a href="https://github.com/INCEPTdk/adaptr/blob/HEAD/R/run_trials.R" class="external-link"><code>R/run_trials.R</code></a></small>
      <div class="d-none name"><code>run_trials.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function conducts multiple simulations using a trial specification as
specified by <code><a href="setup_trial.html">setup_trial()</a></code>, <code><a href="setup_trial_binom.html">setup_trial_binom()</a></code> or <code><a href="setup_trial_norm.html">setup_trial_norm()</a></code>.
This function essentially manages random seeds and runs multiple simulation
using <code><a href="run_trial.html">run_trial()</a></code> - additional details on individual simulations are
provided in that function's description. This function allows simulating
trials in parallel using multiple cores, automatically saving and re-loading
saved objects, and "growing" already saved simulation files (i.e., appending
additional simulations to the same file).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_trials</span><span class="op">(</span></span>
<span>  <span class="va">trial_spec</span>,</span>
<span>  <span class="va">n_rep</span>,</span>
<span>  path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  grow <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  base_seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sparse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  version <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  compress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  export <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  export_envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>trial_spec</dt>
<dd><p><code>trial_spec</code> object, generated and validated by the
<code><a href="setup_trial.html">setup_trial()</a></code>, <code><a href="setup_trial_binom.html">setup_trial_binom()</a></code> or <code><a href="setup_trial_norm.html">setup_trial_norm()</a></code> function.</p></dd>


<dt>n_rep</dt>
<dd><p>single integer; the number of simulations to run.</p></dd>


<dt>path</dt>
<dd><p>single character string; if specified (defaults to <code>NULL</code>), files
will be written to and  loaded from this path using the <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code> /
<code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS()</a></code> functions.</p></dd>


<dt>overwrite</dt>
<dd><p>single logical; defaults to <code>FALSE</code>, in which case previous
simulations saved in the same <code>path</code> will be re-loaded (if the same trial
specification was used). If <code>TRUE</code>, the previous file is overwritten (even
if the the same trial specification was not used). If <code>grow</code> is <code>TRUE</code>,
this argument must be set to <code>FALSE</code>.</p></dd>


<dt>grow</dt>
<dd><p>single logical; defaults to <code>FALSE</code>. If <code>TRUE</code> and a valid <code>path</code>
to a valid previous file containing less simulations than <code>n_rep</code>, the
additional number of simulations will be run (appropriately re-using the
same <code>base_seed</code>, if specified) and appended to the same file.</p></dd>


<dt>cores</dt>
<dd><p><code>NULL</code> or single integer. If <code>NULL</code>, a default value/cluster set
by <code><a href="setup_cluster.html">setup_cluster()</a></code> will be used to control whether simulations are run in
parallel on a default cluster or sequentially in the main process; if a
cluster/value has not been specified by <code><a href="setup_cluster.html">setup_cluster()</a></code>, <code>cores</code> will
then be set to the value stored in the global <code>"mc.cores"</code> option (if
previously set by <code>options(mc.cores = &lt;number of cores&gt;</code>), and <code>1</code> if that
option has not been specified.<br>
If the resulting number of <code>cores = 1</code>, computations will be run
sequentially in the primary process, and if <code>cores &gt; 1</code>, a new parallel
cluster will be setup using the <code>parallel</code> library and removed once the
function completes. See <code><a href="setup_cluster.html">setup_cluster()</a></code> for details.</p></dd>


<dt>base_seed</dt>
<dd><p>single integer or <code>NULL</code> (default); a random seed used as
the basis for simulations. Regardless of whether simulations are run
sequentially or in parallel, random number streams will be identical and
appropriate (see <code><a href="setup_cluster.html">setup_cluster()</a></code> for details).</p></dd>


<dt>sparse</dt>
<dd><p>single logical, as described in <code><a href="run_trial.html">run_trial()</a></code>; defaults to
<code>TRUE</code> when running multiple simulations, in which case only the data
necessary to summarise all simulations are saved for each simulation.
If <code>FALSE</code>, more detailed data for each simulation is saved, allowing more
detailed printing of individual trial results and plotting using
<code><a href="plot_history.html">plot_history()</a></code> (<code><a href="plot_status.html">plot_status()</a></code> does not require non-sparse results).</p></dd>


<dt>progress</dt>
<dd><p>single numeric <code>&gt; 0</code> and <code>&lt;= 1</code> or <code>NULL</code>. If <code>NULL</code>
(default), no progress is printed to the console. Otherwise, progress
messages are printed to the control at intervals proportional to the value
specified by progress.<br><strong>Note:</strong> as printing is not possible from within clusters on multiple
cores, the function conducts batches of simulations on multiple cores (if
specified), with intermittent printing of statuses. Thus, all cores have to
finish running their current assigned batches before the other cores may
proceed with the next batch. If there are substantial differences in the
simulation speeds across cores, using <code>progress</code> may thus increase total
run time (especially with small values).</p></dd>


<dt>version</dt>
<dd><p>passed to <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code> when saving simulations, defaults to
<code>NULL</code> (as in <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code>), which means that the current default version is
used. Ignored if simulations are not saved.</p></dd>


<dt>compress</dt>
<dd><p>passed to <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code> when saving simulations, defaults to
<code>TRUE</code> (as in <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code>), see <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code> for other options. Ignored if
simulations are not saved.</p></dd>


<dt>export</dt>
<dd><p>character vector of names of objects to export to each
parallel core when running in parallel; passed as the <code>varlist</code> argument to
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parallel::clusterExport()</a></code>. Defaults to <code>NULL</code> (no objects exported),
ignored if <code>cores == 1</code>. See <strong>Details</strong> below.</p></dd>


<dt>export_envir</dt>
<dd><p><code>environment</code> where to look for the objects defined
in <code>export</code> when running in parallel and <code>export</code> is not <code>NULL</code>. Defaults
to the environment from where the function is called.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list of a special class <code>"trial_results"</code>, which contains the
<code>trial_results</code> (results from all simulations; note that <code>seed</code> will be
<code>NULL</code> in the individual simulations), <code>trial_spec</code> (the trial
specification), <code>n_rep</code>, <code>base_seed</code>, <code>elapsed_time</code> (the total simulation
run time), <code>sparse</code> (as described above) and <code>adaptr_version</code> (the version
of the <code>adaptr</code> package used to run the simulations). These results may be
extracted, summarised, and plotted using the <code><a href="extract_results.html">extract_results()</a></code>,
<code><a href="check_performance.html">check_performance()</a></code>, <code><a href="summary.html">summary()</a></code>, <code><a href="print.html">print.trial_results()</a></code>,
<code><a href="plot_convergence.html">plot_convergence()</a></code>, <code><a href="check_remaining_arms.html">check_remaining_arms()</a></code>, <code><a href="plot_status.html">plot_status()</a></code>, and
<code><a href="plot_history.html">plot_history()</a></code> functions. See the definitions of these functions for
additional details and details on additional arguments used to select arms
in simulations not ending in superiority and other summary choices.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Exporting objects when using multiple cores</strong></p>
<p>If <code><a href="setup_trial.html">setup_trial()</a></code> is used to define a trial specification with custom
functions (in the <code>fun_y_gen</code>, <code>fun_draws</code>, and <code>fun_raw_est</code> arguments of
<code><a href="setup_trial.html">setup_trial()</a></code>) and <code>run_trials()</code> is run with <code>cores &gt; 1</code>, it is necessary
to export additional functions or objects used by these functions and defined
by the user outside the function definitions provided. Similarly, functions
from external packages loaded using <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> or <code><a href="https://rdrr.io/r/base/library.html" class="external-link">require()</a></code> must be
exported or called prefixed with the namespace, i.e., <code>package::function</code>.
The <code>export</code> and <code>export_envir</code> arguments are used to export objects calling
the <code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parallel::clusterExport()</a></code>-function. See also <code><a href="setup_cluster.html">setup_cluster()</a></code>, which
may be used to setup a cluster and export required objects only once per
session.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Setup a trial specification</span></span></span>
<span class="r-in"><span><span class="va">binom_trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="setup_trial_binom.html">setup_trial_binom</a></span><span class="op">(</span>arms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                 true_ys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.20</span>, <span class="fl">0.18</span>, <span class="fl">0.22</span>, <span class="fl">0.24</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                 data_looks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run 10 simulations with a specified random base seed</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">run_trials</span><span class="op">(</span><span class="va">binom_trial</span>, n_rep <span class="op">=</span> <span class="fl">10</span>, base_seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># See ?extract_results, ?check_performance, ?summary and ?print for details</span></span></span>
<span class="r-in"><span><span class="co"># on extracting resutls, summarising and printing</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Anders Granholm, Benjamin Skov Kaas-Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

