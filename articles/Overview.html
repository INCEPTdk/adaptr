<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="adaptr">
<title>Overview • adaptr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Overview">
<meta property="og:description" content="adaptr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">adaptr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Overview.html">Overview</a>
    <a class="dropdown-item" href="../articles/Basic-examples.html">Basic examples</a>
    <a class="dropdown-item" href="../articles/Advanced-example.html">Advanced example</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/INCEPTdk/adaptr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Overview</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/INCEPTdk/adaptr/blob/HEAD/vignettes/Overview.Rmd" class="external-link"><code>vignettes/Overview.Rmd</code></a></small>
      <div class="d-none name"><code>Overview.Rmd</code></div>
    </div>

    
    
<p>The <code>adaptr</code> package simulates adaptive (multi-arm,
multi-stage) clinical trials using adaptive stopping, adaptive arm
dropping and/or response-adaptive randomisation.</p>
<p>The package has been developed as part of the <a href="https://incept.dk/" class="external-link">INCEPT (Intensive Care Platform Trial)
project</a>, primarily supported by a grant from <a href="https://www.sygeforsikring.dk/" class="external-link">Sygeforsikringen
“danmark”</a>.</p>
<p>Additional guidance on the key methodological considerations when
planning and comparing adaptive clinical trials can be found in the open
access article <em>“<a href="https://doi.org/10.1016/j.jclinepi.2022.11.002" class="external-link">An overview of
methodological considerations regarding adaptive stopping, arm dropping
and randomisation in clinical trials</a>”</em> available in Journal of
Clinical Epidemiology.</p>
<div class="section level2">
<h2 id="usage-and-workflow-overview">Usage and workflow overview<a class="anchor" aria-label="anchor" href="#usage-and-workflow-overview"></a>
</h2>
<p>The central functionality of <code>adaptr</code> and the typical
workflow is illustrated here.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>First, the package is loaded and a cluster of parallel workers is
initiated by the <code><a href="../reference/setup_cluster.html">setup_cluster()</a></code> function to facilitate
parallel computing:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inceptdk.github.io/adaptr/">adaptr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading 'adaptr' package v1.4.0.</span></span>
<span><span class="co">#&gt; For instructions, type 'help("adaptr")'</span></span>
<span><span class="co">#&gt; or see https://inceptdk.github.io/adaptr/.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/setup_cluster.html">setup_cluster</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Parallelisation is supported in many <code>adaptr</code> functions,
and a cluster of parallel workers can be setup for the entire session
using <code><a href="../reference/setup_cluster.html">setup_cluster()</a></code> early in the script as in this
example. Alternatively, parallelisation can be controlled by the global
<code>"mc.cores"</code> option (set by calling
<code>options(mc.cores = &lt;number&gt;)</code>) or the
<code>cores</code> argument of many functions.</p>
</div>
<div class="section level3">
<h3 id="specify-trial-design">Specify trial design<a class="anchor" aria-label="anchor" href="#specify-trial-design"></a>
</h3>
<p>Setup a trial specification (defining the trial design and scenario)
using the general <code><a href="../reference/setup_trial.html">setup_trial()</a></code> function, or one of the
special case variants using default priors
<code><a href="../reference/setup_trial_binom.html">setup_trial_binom()</a></code> (for binary, binomially distributed
outcomes; used in this example) or <code><a href="../reference/setup_trial_norm.html">setup_trial_norm()</a></code> (for
continuous, normally distributed outcomes).</p>
<p>The example trial specification has the following
characteristics:</p>
<ul>
<li>A binary, binomially distributed, undesirable (default) outcome</li>
<li>Three arms with no designated common control</li>
<li>Identical underlying outcome probabilities of 25% in each arm</li>
<li>Analyses conducted when specific number of patients have outcome
data available, with more patients randomised at all but the last look
(lag due to follow-up and data collection/verification)</li>
<li>No explicitly defined stopping thresholds for
<code>inferiority</code> or <code>superiority</code> (default thresholds
of &lt; 1% and &gt; 99%, respectively, apply)</li>
<li>Equivalence stopping rule defined as &gt; 90% probability
(<code>equivalence_prob</code>) of between-arm differences of all
remaining arms being &lt; 5 %-points</li>
<li>Response-adaptive randomisation with minimum allocation
probabilities of 20% and softening of allocation ratios by a constant
factor (<code>soften_power</code>)</li>
</ul>
<p>See <code>?setup_trial()</code> for details on all the arguments or
<code><a href="../articles/Basic-examples.html">vignette("Basic-examples", "adaptr")</a></code> for
<strong>basic</strong> example trial specifications and a thorough
review of the general trial specification settings, and
<code><a href="../articles/Advanced-example.html">vignette("Advanced-example", "adaptr")</a></code> for an
<strong>advanced</strong> example including details on how to specify
user-written functions for generating outcomes and posterior draws.</p>
<p>Below, the trial specification is setup and a human-readable overview
printed:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binom_trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_trial_binom.html">setup_trial_binom</a></span><span class="op">(</span></span>
<span>  arms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Arm A"</span>, <span class="st">"Arm B"</span>, <span class="st">"Arm C"</span><span class="op">)</span>,</span>
<span>  true_ys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>  min_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.20</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  data_looks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">300</span>, to <span class="op">=</span> <span class="fl">2000</span>, by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  randomised_at_looks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">400</span>, to <span class="op">=</span> <span class="fl">2000</span>, by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, <span class="fl">2000</span><span class="op">)</span>,</span>
<span>  equivalence_prob <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  equivalence_diff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  soften_power <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">binom_trial</span>, prob_digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trial specification: generic binomially distributed outcome trial</span></span>
<span><span class="co">#&gt; * Undesirable outcome</span></span>
<span><span class="co">#&gt; * No common control arm</span></span>
<span><span class="co">#&gt; * Best arms: Arm A and Arm B and Arm C</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Arms, true outcomes, starting allocation probabilities </span></span>
<span><span class="co">#&gt; and allocation probability limits:</span></span>
<span><span class="co">#&gt;   arms true_ys start_probs fixed_probs min_probs max_probs</span></span>
<span><span class="co">#&gt;  Arm A    0.25       0.333          NA       0.2        NA</span></span>
<span><span class="co">#&gt;  Arm B    0.25       0.333          NA       0.2        NA</span></span>
<span><span class="co">#&gt;  Arm C    0.25       0.333          NA       0.2        NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Maximum sample size: 2000 </span></span>
<span><span class="co">#&gt; Maximum number of data looks: 18</span></span>
<span><span class="co">#&gt; Planned data looks after:  300, 400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000 patients have reached follow-up</span></span>
<span><span class="co">#&gt; Number of patients randomised at each look:  400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Superiority threshold: 0.99 (all analyses)</span></span>
<span><span class="co">#&gt; Inferiority threshold: 0.01 (all analyses)</span></span>
<span><span class="co">#&gt; Equivalence threshold: 0.9 (all analyses) (no common control)</span></span>
<span><span class="co">#&gt; Absolute equivalence difference: 0.05</span></span>
<span><span class="co">#&gt; No futility threshold (not relevant - no common control)</span></span>
<span><span class="co">#&gt; Soften power for all analyses: 0.5</span></span></code></pre></div>
<p>By default, (most) probabilities are shown with 3 decimals. This can
be changed by explicitly <code><a href="../reference/print.html">print()</a></code>ing the specification with
the <code>prob_digits</code> arguments, for example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">binom_trial</span>, prob_digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trial specification: generic binomially distributed outcome trial</span></span>
<span><span class="co">#&gt; * Undesirable outcome</span></span>
<span><span class="co">#&gt; * No common control arm</span></span>
<span><span class="co">#&gt; * Best arms: Arm A and Arm B and Arm C</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Arms, true outcomes, starting allocation probabilities </span></span>
<span><span class="co">#&gt; and allocation probability limits:</span></span>
<span><span class="co">#&gt;   arms true_ys start_probs fixed_probs min_probs max_probs</span></span>
<span><span class="co">#&gt;  Arm A    0.25        0.33          NA       0.2        NA</span></span>
<span><span class="co">#&gt;  Arm B    0.25        0.33          NA       0.2        NA</span></span>
<span><span class="co">#&gt;  Arm C    0.25        0.33          NA       0.2        NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Maximum sample size: 2000 </span></span>
<span><span class="co">#&gt; Maximum number of data looks: 18</span></span>
<span><span class="co">#&gt; Planned data looks after:  300, 400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000 patients have reached follow-up</span></span>
<span><span class="co">#&gt; Number of patients randomised at each look:  400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Superiority threshold: 0.99 (all analyses)</span></span>
<span><span class="co">#&gt; Inferiority threshold: 0.01 (all analyses)</span></span>
<span><span class="co">#&gt; Equivalence threshold: 0.9 (all analyses) (no common control)</span></span>
<span><span class="co">#&gt; Absolute equivalence difference: 0.05</span></span>
<span><span class="co">#&gt; No futility threshold (not relevant - no common control)</span></span>
<span><span class="co">#&gt; Soften power for all analyses: 0.5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calibration">Calibration<a class="anchor" aria-label="anchor" href="#calibration"></a>
</h3>
<p>In the example trial specification, there are no true between-arm
differences, and stopping rules for inferiority and superiority are not
explicitly defined. This is intentional, as these stopping rules will be
calibrated to obtain a desired probability of stopping for superiority
in the scenario with no between-arm differences (corresponding to the
Bayesian type 1 error rate). Trial specifications do not necessarily
have to be calibrated. Instead,simulations can be run directly using the
<code><a href="../reference/run_trials.html">run_trials()</a></code> function covered below (or
<code><a href="../reference/run_trial.html">run_trial()</a></code> for a single simulation). This can be followed
by assessment of performance metrics, and manually changing the
specification (including the stopping rules) until performance metrics
are considered acceptable. In this example, a full calibration procedure
is performed.</p>
<p>Calibration of a trial specification is done using the
<code><a href="../reference/calibrate_trial.html">calibrate_trial()</a></code> function, which defaults to calibrate
constant, symmetrical stopping rules for inferiority and superiority
(expecting a trial specification with identical outcomes in each arm),
but can be used to calibrate any parameter in a trial specification
towards any performance metric if a user-defined calibration function
(<code>fun</code>) is specified.</p>
<p>To perform the calibration, a <code>target</code> value, a
<code>search_range</code>, a tolerance value (<code>tol</code>), and the
allowed direction of the tolerance value (<code>dir</code>) must be
specified (or alternatively, the defaults can be used). Of note, the
number of simulations in each calibration step here is lower than
generally recommended (to reduce the time required to build this
vignette):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calibrate the trial specification</span></span>
<span><span class="va">calibrated_binom_trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibrate_trial.html">calibrate_trial</a></span><span class="op">(</span></span>
<span>  trial_spec <span class="op">=</span> <span class="va">binom_trial</span>,</span>
<span>  n_rep <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># 1000 simulations for each step (more generally recommended)</span></span>
<span>  base_seed <span class="op">=</span> <span class="fl">4131</span>, <span class="co"># Base random seed (for reproducible results)</span></span>
<span>  target <span class="op">=</span> <span class="fl">0.05</span>, <span class="co"># Target value for calibrated metric (default value)</span></span>
<span>  search_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co"># Search range for superiority stopping threshold</span></span>
<span>  tol <span class="op">=</span> <span class="fl">0.01</span>, <span class="co"># Tolerance range</span></span>
<span>  dir <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="co"># Tolerance range only applies below target</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print result (to check if calibration is successful)</span></span>
<span><span class="va">calibrated_binom_trial</span></span>
<span><span class="co">#&gt; Trial calibration:</span></span>
<span><span class="co">#&gt; * Result: calibration successful</span></span>
<span><span class="co">#&gt; * Best x: 0.9830921</span></span>
<span><span class="co">#&gt; * Best y: 0.045</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Central settings:</span></span>
<span><span class="co">#&gt; * Target: 0.05</span></span>
<span><span class="co">#&gt; * Tolerance: 0.01 (at or below target, range: 0.04 to 0.05)</span></span>
<span><span class="co">#&gt; * Search range: 0.9 to 1</span></span>
<span><span class="co">#&gt; * Gaussian process controls:</span></span>
<span><span class="co">#&gt; * - resolution: 5000</span></span>
<span><span class="co">#&gt; * - kappa: 0.5</span></span>
<span><span class="co">#&gt; * - pow: 1.95</span></span>
<span><span class="co">#&gt; * - lengthscale: 1 (constant)</span></span>
<span><span class="co">#&gt; * - x scaled: yes</span></span>
<span><span class="co">#&gt; * Noisy: no</span></span>
<span><span class="co">#&gt; * Narrowing: yes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration/simulation details:</span></span>
<span><span class="co">#&gt; * Total evaluations: 4 (previous + grid + iterations)</span></span>
<span><span class="co">#&gt; * Repetitions: 1000</span></span>
<span><span class="co">#&gt; * Calibration time: 54.3 secs</span></span>
<span><span class="co">#&gt; * Base random seed: 4131</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; See 'help("calibrate_trial")' for details.</span></span></code></pre></div>
<p>The calibration is successful (if not, results should not be used,
and the calibration settings should be changed and the calibration
repeated). The calibrated, constant stopping threshold for superiority
is printed with the results (0.9830921) and can be extracted using
<code>calibrated_binom_trial$best_x</code>. Using the default
calibration functionality, the calibrated, constant stopping threshold
for inferiority is symmetrical, i.e.,
<code>1 - stopping threshold for superiority</code> (0.0169079). The
calibrated trial specification may be extracted using
<code>calibrated_binom_trial$best_trial_spec</code> and, if printed,
will also include the calibrated stopping thresholds.</p>
<p>Calibration results may be saved and reloaded by using the
<code>path</code> argument, to avoid unnecessary repeated
simulations.</p>
</div>
<div class="section level3">
<h3 id="summarising-results">Summarising results<a class="anchor" aria-label="anchor" href="#summarising-results"></a>
</h3>
<p>The results of the simulations using the calibrated trial
specification conducted during the calibration procedure may be
extracted using <code>calibrated_binom_trial$best_sims</code>. These
results can be summarised with several functions. Most of these
functions support different ‘selection strategies’ for simulations not
ending with superiority, i.e., performance metrics can be calculated
assuming different arms would be used in clinical practice if no arm is
ultimately superior.</p>
<p>The <code><a href="../reference/check_performance.html">check_performance()</a></code> function summarises performance
metrics in a tidy <code>data.frame</code>, with uncertainty measures
(bootstrapped confidence intervals) if requested. Here, performance
metrics are calculated considering the ‘best’ arm (i.e., the one with
the highest probability of being overall best) selected in simulations
not ending with superiority:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate performance metrics with uncertainty measures</span></span>
<span><span class="va">binom_trial_performance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_performance.html">check_performance</a></span><span class="op">(</span></span>
<span>  <span class="va">calibrated_binom_trial</span><span class="op">$</span><span class="va">best_sims</span>,</span>
<span>  select_strategy <span class="op">=</span> <span class="st">"best"</span>,</span>
<span>  uncertainty <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Calculate uncertainty measures</span></span>
<span>  n_boot <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># 1000 bootstrap samples (more typically recommended)</span></span>
<span>  ci_width <span class="op">=</span> <span class="fl">0.95</span>, <span class="co"># 95% confidence intervals (default)</span></span>
<span>  boot_seed <span class="op">=</span> <span class="st">"base"</span> <span class="co"># Use same random seed for bootstrapping as for simulations</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print results </span></span>
<span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">binom_trial_performance</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   metric     est err_sd err_mad   lo_ci   hi_ci</span></span>
<span><span class="co">#&gt; 1           n_summarised 1000.00   0.00    0.00 1000.00 1000.00</span></span>
<span><span class="co">#&gt; 2              size_mean 1757.20  11.26   11.12 1736.20 1779.10</span></span>
<span><span class="co">#&gt; 3                size_sd  370.74   9.31    9.34  353.87  389.70</span></span>
<span><span class="co">#&gt; 4            size_median 2000.00   0.00    0.00 2000.00 2000.00</span></span>
<span><span class="co">#&gt; 5               size_p25 1500.00  47.25    0.00 1400.00 1500.00</span></span>
<span><span class="co">#&gt; 6               size_p75 2000.00   0.00    0.00 2000.00 2000.00</span></span>
<span><span class="co">#&gt; 7                size_p0  400.00     NA      NA      NA      NA</span></span>
<span><span class="co">#&gt; 8              size_p100 2000.00     NA      NA      NA      NA</span></span>
<span><span class="co">#&gt; 9            sum_ys_mean  440.16   2.90    2.91  434.50  445.89</span></span>
<span><span class="co">#&gt; 10             sum_ys_sd   95.56   2.34    2.41   91.15  100.14</span></span>
<span><span class="co">#&gt; 11         sum_ys_median  487.00   1.36    0.74  484.00  489.00</span></span>
<span><span class="co">#&gt; 12            sum_ys_p25  366.00   9.63    8.90  353.00  387.00</span></span>
<span><span class="co">#&gt; 13            sum_ys_p75  506.00   1.09    1.48  504.00  508.00</span></span>
<span><span class="co">#&gt; 14             sum_ys_p0   88.00     NA      NA      NA      NA</span></span>
<span><span class="co">#&gt; 15           sum_ys_p100  572.00     NA      NA      NA      NA</span></span>
<span><span class="co">#&gt; 16         ratio_ys_mean    0.25   0.00    0.00    0.25    0.25</span></span>
<span><span class="co">#&gt; 17           ratio_ys_sd    0.01   0.00    0.00    0.01    0.01</span></span>
<span><span class="co">#&gt; 18       ratio_ys_median    0.25   0.00    0.00    0.25    0.25</span></span>
<span><span class="co">#&gt; 19          ratio_ys_p25    0.24   0.00    0.00    0.24    0.24</span></span>
<span><span class="co">#&gt; 20          ratio_ys_p75    0.26   0.00    0.00    0.26    0.26</span></span>
<span><span class="co">#&gt; 21           ratio_ys_p0    0.19     NA      NA      NA      NA</span></span>
<span><span class="co">#&gt; 22         ratio_ys_p100    0.30     NA      NA      NA      NA</span></span>
<span><span class="co">#&gt; 23       prob_conclusive    0.42   0.02    0.01    0.39    0.45</span></span>
<span><span class="co">#&gt; 24         prob_superior    0.04   0.01    0.01    0.03    0.06</span></span>
<span><span class="co">#&gt; 25      prob_equivalence    0.38   0.02    0.01    0.35    0.41</span></span>
<span><span class="co">#&gt; 26         prob_futility    0.00   0.00    0.00    0.00    0.00</span></span>
<span><span class="co">#&gt; 27              prob_max    0.58   0.02    0.01    0.55    0.61</span></span>
<span><span class="co">#&gt; 28 prob_select_arm_Arm A    0.35   0.01    0.01    0.32    0.38</span></span>
<span><span class="co">#&gt; 29 prob_select_arm_Arm B    0.33   0.01    0.01    0.30    0.36</span></span>
<span><span class="co">#&gt; 30 prob_select_arm_Arm C    0.32   0.01    0.01    0.29    0.35</span></span>
<span><span class="co">#&gt; 31      prob_select_none    0.00   0.00    0.00    0.00    0.00</span></span>
<span><span class="co">#&gt; 32                  rmse    0.02   0.00    0.00    0.02    0.02</span></span>
<span><span class="co">#&gt; 33               rmse_te      NA     NA      NA      NA      NA</span></span>
<span><span class="co">#&gt; 34                   mae    0.01   0.00    0.00    0.01    0.01</span></span>
<span><span class="co">#&gt; 35                mae_te      NA     NA      NA      NA      NA</span></span>
<span><span class="co">#&gt; 36                   idp      NA     NA      NA      NA      NA</span></span></code></pre></div>
<p>Similar results in <code>list</code> format (without uncertainty
measures) can be obtained using the <code><a href="../reference/summary.html">summary()</a></code> method (as
known from, e.g., regression models in<code>R</code>), which comes with
a <code><a href="../reference/print.html">print()</a></code> method providing formatted results. If the
simulation results are printed directly, this function is called with
the default arguments (all arguments, e.g., selection strategies may
also be directly supplied to the <code><a href="../reference/print.html">print()</a></code> method).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binom_trial_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span></span>
<span>  <span class="va">calibrated_binom_trial</span><span class="op">$</span><span class="va">best_sims</span>,</span>
<span>  select_strategy <span class="op">=</span> <span class="st">"best"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">binom_trial_summary</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Multiple simulation results: generic binomially distributed outcome trial</span></span>
<span><span class="co">#&gt; * Undesirable outcome</span></span>
<span><span class="co">#&gt; * Number of simulations: 1000</span></span>
<span><span class="co">#&gt; * Number of simulations summarised: 1000 (all trials)</span></span>
<span><span class="co">#&gt; * No common control arm</span></span>
<span><span class="co">#&gt; * Selection strategy: best remaining available</span></span>
<span><span class="co">#&gt; * Treatment effect compared to: no comparison</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Performance metrics (using posterior estimates from final analysis [all patients]):</span></span>
<span><span class="co">#&gt; * Sample sizes: mean 1757.20 (SD: 370.74) | median 2000.00 (IQR: 1500.00 to 2000.00) [range: 400.00 to 2000.00]</span></span>
<span><span class="co">#&gt; * Total summarised outcomes: mean 440.16 (SD: 95.56) | median 487.00 (IQR: 366.00 to 506.00) [range: 88.00 to 572.00]</span></span>
<span><span class="co">#&gt; * Total summarised outcome rates: mean 0.2503 (SD: 0.0109) | median 0.2500 (IQR: 0.2435 to 0.2573) [range: 0.1900 to 0.2950]</span></span>
<span><span class="co">#&gt; * Conclusive: 42.50%</span></span>
<span><span class="co">#&gt; * Superiority: 4.50%</span></span>
<span><span class="co">#&gt; * Equivalence: 38.00%</span></span>
<span><span class="co">#&gt; * Futility: 0.00% [not assessed]</span></span>
<span><span class="co">#&gt; * Inconclusive at max sample size: 57.50%</span></span>
<span><span class="co">#&gt; * Selection probabilities: Arm A: 35.10% | Arm B: 32.90% | Arm C: 32.00% | None: 0.00%</span></span>
<span><span class="co">#&gt; * RMSE / MAE: 0.01767 / 0.01164</span></span>
<span><span class="co">#&gt; * RMSE / MAE treatment effect: not estimated / not estimated</span></span>
<span><span class="co">#&gt; * Ideal design percentage: not estimable</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation details:</span></span>
<span><span class="co">#&gt; * Simulation time: 20.2 secs</span></span>
<span><span class="co">#&gt; * Base random seed: 4131</span></span>
<span><span class="co">#&gt; * Credible interval width: 95%</span></span>
<span><span class="co">#&gt; * Number of posterior draws: 5000</span></span>
<span><span class="co">#&gt; * Estimation method: posterior medians with MAD-SDs</span></span></code></pre></div>
<p>Individual simulation results can be extracted in a tidy
<code>data.frame</code> using <code><a href="../reference/extract_results.html">extract_results()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binom_trial_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_results.html">extract_results</a></span><span class="op">(</span></span>
<span>  <span class="va">calibrated_binom_trial</span><span class="op">$</span><span class="va">best_sims</span>,</span>
<span>  select_strategy <span class="op">=</span> <span class="st">"best"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">binom_trial_results</span><span class="op">)</span> <span class="co"># Number of rows/simulations</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">binom_trial_results</span><span class="op">)</span> <span class="co"># Print the first rows</span></span>
<span><span class="co">#&gt;   sim final_n sum_ys ratio_ys final_status superior_arm selected_arm</span></span>
<span><span class="co">#&gt; 1   1    2000    478   0.2390  equivalence         &lt;NA&gt;        Arm A</span></span>
<span><span class="co">#&gt; 2   2    2000    488   0.2440          max         &lt;NA&gt;        Arm A</span></span>
<span><span class="co">#&gt; 3   3    2000    521   0.2605          max         &lt;NA&gt;        Arm C</span></span>
<span><span class="co">#&gt; 4   4    2000    500   0.2500          max         &lt;NA&gt;        Arm C</span></span>
<span><span class="co">#&gt; 5   5    2000    471   0.2355          max         &lt;NA&gt;        Arm A</span></span>
<span><span class="co">#&gt; 6   6    2000    503   0.2515          max         &lt;NA&gt;        Arm B</span></span>
<span><span class="co">#&gt;             err       sq_err err_te sq_err_te</span></span>
<span><span class="co">#&gt; 1 -0.0134029565 1.796392e-04     NA        NA</span></span>
<span><span class="co">#&gt; 2 -0.0118977741 1.415570e-04     NA        NA</span></span>
<span><span class="co">#&gt; 3  0.0004940695 2.441046e-07     NA        NA</span></span>
<span><span class="co">#&gt; 4 -0.0127647255 1.629382e-04     NA        NA</span></span>
<span><span class="co">#&gt; 5 -0.0232813002 5.420189e-04     NA        NA</span></span>
<span><span class="co">#&gt; 6 -0.0154278469 2.380185e-04     NA        NA</span></span></code></pre></div>
<p>Finally, the probabilities of different remaining arms and their
statuses (with uncertainty) at the last adaptive analysis can be
summarised using the <code><a href="../reference/check_remaining_arms.html">check_remaining_arms()</a></code> function
(dropped arms will be shown with an empty text string):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_remaining_arms.html">check_remaining_arms</a></span><span class="op">(</span></span>
<span>  <span class="va">calibrated_binom_trial</span><span class="op">$</span><span class="va">best_sims</span>,</span>
<span>  ci_width <span class="op">=</span> <span class="fl">0.95</span> <span class="co"># 95% confidence intervals (default)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;     arm_Arm A   arm_Arm B   arm_Arm C   n  prop         se      lo_ci</span></span>
<span><span class="co">#&gt; 1      active      active      active 528 0.528 0.02172556 0.48541868</span></span>
<span><span class="co">#&gt; 2             equivalence equivalence 121 0.121 0.02964793 0.06289112</span></span>
<span><span class="co">#&gt; 3 equivalence equivalence             120 0.120 0.02966479 0.06185807</span></span>
<span><span class="co">#&gt; 4 equivalence             equivalence 108 0.108 0.02986637 0.04946299</span></span>
<span><span class="co">#&gt; 5 equivalence equivalence equivalence  31 0.031 0.03112876 0.00000000</span></span>
<span><span class="co">#&gt; 6                            superior  22 0.022 0.03127299 0.00000000</span></span>
<span><span class="co">#&gt; 7                superior              14 0.014 0.03140064 0.00000000</span></span>
<span><span class="co">#&gt; 8    superior                           9 0.009 0.03148015 0.00000000</span></span>
<span><span class="co">#&gt;        hi_ci</span></span>
<span><span class="co">#&gt; 1 0.57058132</span></span>
<span><span class="co">#&gt; 2 0.17910888</span></span>
<span><span class="co">#&gt; 3 0.17814193</span></span>
<span><span class="co">#&gt; 4 0.16653701</span></span>
<span><span class="co">#&gt; 5 0.09201126</span></span>
<span><span class="co">#&gt; 6 0.08329394</span></span>
<span><span class="co">#&gt; 7 0.07554412</span></span>
<span><span class="co">#&gt; 8 0.07069997</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualising-results">Visualising results<a class="anchor" aria-label="anchor" href="#visualising-results"></a>
</h3>
<p>Several visualisation functions are included (all are optional, and
all require the <code>ggplot2</code> package installed).</p>
<p>Convergence and stability of one or more performance metrics may be
visually assessed using <code><a href="../reference/plot_convergence.html">plot_convergence()</a></code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span></span>
<span>  <span class="va">calibrated_binom_trial</span><span class="op">$</span><span class="va">best_sims</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size mean"</span>, <span class="st">"prob_superior"</span>, <span class="st">"prob_equivalence"</span><span class="op">)</span>,</span>
<span>  <span class="co"># select_strategy can be specified, but does not affect the chosen metrics</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Plotting other metrics is possible; see the
<code><a href="../reference/plot_convergence.html">plot_convergence()</a></code> documentation. The simulation results
may also be split into separate, consecutive batches when assessing
convergence, to further assess the stability:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span></span>
<span>  <span class="va">calibrated_binom_trial</span><span class="op">$</span><span class="va">best_sims</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size mean"</span>, <span class="st">"prob_superior"</span>, <span class="st">"prob_equivalence"</span><span class="op">)</span>,</span>
<span>  n_split <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-11-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The status probabilities for the overall trial according to trial
progress can be visualised using the <code><a href="../reference/plot_status.html">plot_status()</a></code>
function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_status.html">plot_status</a></span><span class="op">(</span></span>
<span>  <span class="va">calibrated_binom_trial</span><span class="op">$</span><span class="va">best_sims</span>,</span>
<span>  x_value <span class="op">=</span> <span class="st">"total n"</span> <span class="co"># Total number of randomised patients at X-axis</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Similarly, the status probabilities for one or more specific trial
arms can be visualised:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_status.html">plot_status</a></span><span class="op">(</span></span>
<span>  <span class="va">calibrated_binom_trial</span><span class="op">$</span><span class="va">best_sims</span>,</span>
<span>  x_value <span class="op">=</span> <span class="st">"total n"</span>,</span>
<span>  arm <span class="op">=</span> <span class="cn">NA</span> <span class="co"># NA for all arms or character vector for specific arms</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Finally, various metrics may be summarised over the progress of one
or multiple trial simulations using the <code><a href="../reference/plot_history.html">plot_history()</a></code>
function, which requires non-sparse results (the <code>sparse</code>
argument must be <code>FALSE</code> in <code>calibrate_trials()</code>,
<code><a href="../reference/run_trials.html">run_trials()</a></code>, or <code><a href="../reference/run_trial.html">run_trial()</a></code>, leading to
additional results being saved - all other functions work with sparse
results). This will be illustrated below.</p>
</div>
<div class="section level3">
<h3 id="use-calibrated-stopping-thresholds-in-another-scenario">Use calibrated stopping thresholds in another scenario<a class="anchor" aria-label="anchor" href="#use-calibrated-stopping-thresholds-in-another-scenario"></a>
</h3>
<p>The calibrated stopping thresholds (calibrated in a scenario with no
between-arm differences) may be used to run simulations with the same
overall trial specification, but according to a different scenario
(i.e., with between-arm differences present) to assess performance
metrics (including the Bayesian analogue of power).</p>
<p>First, a new trial specification is setup using the same settings as
before, except for between-arm differences and the calibrated stopping
thresholds:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binom_trial_calib_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_trial_binom.html">setup_trial_binom</a></span><span class="op">(</span></span>
<span>  arms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Arm A"</span>, <span class="st">"Arm B"</span>, <span class="st">"Arm C"</span><span class="op">)</span>,</span>
<span>  true_ys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span><span class="op">)</span>, <span class="co"># Different outcomes in the arms</span></span>
<span>  min_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.20</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  data_looks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">300</span>, to <span class="op">=</span> <span class="fl">2000</span>, by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  randomised_at_looks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">400</span>, to <span class="op">=</span> <span class="fl">2000</span>, by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, <span class="fl">2000</span><span class="op">)</span>,</span>
<span>  <span class="co"># Stopping rules for inferiority/superiority explicitly defined</span></span>
<span>  <span class="co"># using the calibration results</span></span>
<span>  inferiority <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">calibrated_binom_trial</span><span class="op">$</span><span class="va">best_x</span>,</span>
<span>  superiority <span class="op">=</span> <span class="va">calibrated_binom_trial</span><span class="op">$</span><span class="va">best_x</span>,</span>
<span>  equivalence_prob <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  equivalence_diff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  soften_power <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Simulations using the trial specification with calibrated stopping
thresholds and differences present can then be conducted using the
<code><a href="../reference/run_trials.html">run_trials()</a></code> function. Here, we specify that non-sparse
results will be returned (to illustrate the <code><a href="../reference/plot_history.html">plot_history()</a></code>
function).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binom_trial_diff_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_trials.html">run_trials</a></span><span class="op">(</span></span>
<span>  <span class="va">binom_trial_calib_diff</span>,</span>
<span>  n_rep <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># 1000 simulations (more generally recommended)</span></span>
<span>  base_seed <span class="op">=</span> <span class="fl">1234</span>, <span class="co"># Reproducible results</span></span>
<span>  sparse <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># Return additional results for visualisation</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Again, simulations may be saved and reloaded using the
<code>path</code> argument.</p>
<p>We then calculate performance metrics as above:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_performance.html">check_performance</a></span><span class="op">(</span></span>
<span>  <span class="va">binom_trial_diff_sims</span>,</span>
<span>  select_strategy <span class="op">=</span> <span class="st">"best"</span>,</span>
<span>  uncertainty <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_boot <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># 1000 bootstrap samples (more typically recommended)</span></span>
<span>  ci_width <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  boot_seed <span class="op">=</span> <span class="st">"base"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;                   metric      est err_sd err_mad    lo_ci    hi_ci</span></span>
<span><span class="co">#&gt; 1           n_summarised 1000.000  0.000   0.000 1000.000 1000.000</span></span>
<span><span class="co">#&gt; 2              size_mean 1245.100 16.618  17.272 1215.185 1277.702</span></span>
<span><span class="co">#&gt; 3                size_sd  510.702  7.414   7.436  496.194  525.386</span></span>
<span><span class="co">#&gt; 4            size_median 1200.000 46.824   0.000 1200.000 1300.000</span></span>
<span><span class="co">#&gt; 5               size_p25  800.000 35.902   0.000  800.000  900.000</span></span>
<span><span class="co">#&gt; 6               size_p75 1700.000 46.345   0.000 1600.000 1700.000</span></span>
<span><span class="co">#&gt; 7                size_p0  400.000     NA      NA       NA       NA</span></span>
<span><span class="co">#&gt; 8              size_p100 2000.000     NA      NA       NA       NA</span></span>
<span><span class="co">#&gt; 9            sum_ys_mean  287.066  3.697   3.827  280.241  294.549</span></span>
<span><span class="co">#&gt; 10             sum_ys_sd  113.660  1.697   1.650  110.337  116.954</span></span>
<span><span class="co">#&gt; 11         sum_ys_median  286.000  5.981   7.413  274.500  295.000</span></span>
<span><span class="co">#&gt; 12            sum_ys_p25  194.750  7.147   7.413  180.731  207.756</span></span>
<span><span class="co">#&gt; 13            sum_ys_p75  382.250  6.961   7.042  370.000  395.250</span></span>
<span><span class="co">#&gt; 14             sum_ys_p0   85.000     NA      NA       NA       NA</span></span>
<span><span class="co">#&gt; 15           sum_ys_p100  518.000     NA      NA       NA       NA</span></span>
<span><span class="co">#&gt; 16         ratio_ys_mean    0.233  0.000   0.001    0.232    0.234</span></span>
<span><span class="co">#&gt; 17           ratio_ys_sd    0.016  0.000   0.000    0.015    0.016</span></span>
<span><span class="co">#&gt; 18       ratio_ys_median    0.232  0.001   0.001    0.231    0.233</span></span>
<span><span class="co">#&gt; 19          ratio_ys_p25    0.222  0.001   0.001    0.220    0.224</span></span>
<span><span class="co">#&gt; 20          ratio_ys_p75    0.243  0.001   0.001    0.241    0.244</span></span>
<span><span class="co">#&gt; 21           ratio_ys_p0    0.196     NA      NA       NA       NA</span></span>
<span><span class="co">#&gt; 22         ratio_ys_p100    0.298     NA      NA       NA       NA</span></span>
<span><span class="co">#&gt; 23       prob_conclusive    0.882  0.011   0.010    0.862    0.902</span></span>
<span><span class="co">#&gt; 24         prob_superior    0.719  0.015   0.015    0.690    0.747</span></span>
<span><span class="co">#&gt; 25      prob_equivalence    0.163  0.012   0.012    0.139    0.185</span></span>
<span><span class="co">#&gt; 26         prob_futility    0.000  0.000   0.000    0.000    0.000</span></span>
<span><span class="co">#&gt; 27              prob_max    0.118  0.011   0.010    0.098    0.138</span></span>
<span><span class="co">#&gt; 28 prob_select_arm_Arm A    0.033  0.005   0.004    0.023    0.043</span></span>
<span><span class="co">#&gt; 29 prob_select_arm_Arm B    0.967  0.005   0.004    0.957    0.977</span></span>
<span><span class="co">#&gt; 30 prob_select_arm_Arm C    0.000  0.000   0.000    0.000    0.000</span></span>
<span><span class="co">#&gt; 31      prob_select_none    0.000  0.000   0.000    0.000    0.000</span></span>
<span><span class="co">#&gt; 32                  rmse    0.020  0.001   0.001    0.019    0.022</span></span>
<span><span class="co">#&gt; 33               rmse_te       NA     NA      NA       NA       NA</span></span>
<span><span class="co">#&gt; 34                   mae    0.011  0.000   0.000    0.010    0.012</span></span>
<span><span class="co">#&gt; 35                mae_te       NA     NA      NA       NA       NA</span></span>
<span><span class="co">#&gt; 36                   idp   98.350  0.264   0.222   97.849   98.850</span></span></code></pre></div>
<p>Similarly, overall trial statuses for the scenario with differences
are visualised:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_status.html">plot_status</a></span><span class="op">(</span><span class="va">binom_trial_diff_sims</span>, x_value <span class="op">=</span> <span class="st">"total n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-17-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Statuses for each arm in this scenario are also visualised:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_status.html">plot_status</a></span><span class="op">(</span><span class="va">binom_trial_diff_sims</span>, x_value <span class="op">=</span> <span class="st">"total n"</span>, arm <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-18-1.png" width="576" style="display: block; margin: auto;"></p>
<p>We can plot the median and interquartile ranges of allocation
probabilities in each arm over time using the
<code><a href="../reference/plot_history.html">plot_history()</a></code> function (requiring non-sparse results,
leading to substantially larger objects and files if saved):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_history.html">plot_history</a></span><span class="op">(</span></span>
<span>  <span class="va">binom_trial_diff_sims</span>,</span>
<span>  x_value <span class="op">=</span> <span class="st">"total n"</span>,</span>
<span>  y_value <span class="op">=</span> <span class="st">"prob"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-19-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Similarly, the median (interquartile range) number of patients
allocated to each arm as the trial progresses can be visualised:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_history.html">plot_history</a></span><span class="op">(</span></span>
<span>  <span class="va">binom_trial_diff_sims</span>,</span>
<span>  x_value <span class="op">=</span> <span class="st">"total n"</span>,</span>
<span>  y_value <span class="op">=</span> <span class="st">"n all"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-20-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Plotting other metrics is possible; see the
<code><a href="../reference/plot_history.html">plot_history()</a></code> documentation.</p>
</div>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>If you use the package, please consider citing it:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"adaptr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; To cite package 'adaptr' in publications use:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Granholm A, Jensen AKG, Lange T, Kaas-Hansen BS (2022). adaptr: an R</span></span>
<span><span class="co">#&gt;   package for simulating and comparing adaptive clinical trials.</span></span>
<span><span class="co">#&gt;   Journal of Open Source Software, 7(72), 4284. URL</span></span>
<span><span class="co">#&gt;   https://doi.org/10.21105/joss.04284.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   @Article{,</span></span>
<span><span class="co">#&gt;     title = {{adaptr}: an R package for simulating and comparing adaptive clinical trials},</span></span>
<span><span class="co">#&gt;     author = {Anders Granholm and Aksel Karl Georg Jensen and Theis Lange and Benjamin Skov Kaas-Hansen},</span></span>
<span><span class="co">#&gt;     journal = {Journal of Open Source Software},</span></span>
<span><span class="co">#&gt;     year = {2022},</span></span>
<span><span class="co">#&gt;     volume = {7},</span></span>
<span><span class="co">#&gt;     number = {72},</span></span>
<span><span class="co">#&gt;     pages = {4284},</span></span>
<span><span class="co">#&gt;     url = {https://doi.org/10.21105/joss.04284},</span></span>
<span><span class="co">#&gt;     doi = {10.21105/joss.04284},</span></span>
<span><span class="co">#&gt;   }</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anders Granholm, Benjamin Skov Kaas-Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
